[TOC]



# 一、内部类

## 1.定义

- Java语言中类可以嵌套定义，广义的内部类指的是定义在另一个类当中的一个类。

## 2.特点

1. 访问权限修饰符，有四种访问权限，都可以使用

2. 成员特点:没有static声明，除此之外，和普通类一致；允许final修饰的全局常量存在，但一定是不会触发类加载的字面值常量赋值的全局常量才允许。

   - 成员内部类可以看成外围类的一个成员，**要想得到成员内部类对象，需要先创建外围类对象，在外围类对象的基础上，才能创建成员内部类对象。**

     > <span style="background:yellow;color:red">原理：通过编译器在编译成员内部类代码时，将外围类对象的引用添加到成员内部类的成员变量列表中实现，成员内部类对象，必须持有外围类对象的引用</span>

   - 成员内部类始终是一个类，创建它的对象也需要类加载，而且类加载的顺序应该是先加载外围类再加载内部类，**所以成员内部类没有静态声明。**

3. 继承和实现：可以继承和实现外部类和接口

## 3.成员内部类的访问特征

明确两个要点：

1. 成员内部类和外围类直接相互访问都不受访问权限限制

2. 成员内部类依赖于外围类对象而存在，

   - 所以成员内部类的成员方法中有两个对象，**（自身对象用this关键字指向，外围类对象用外围类类名.this指向；都是隐含的）**

   - 但是外围类对象不依赖于其他对象，所以这里只存在一个对象，用this指向。

     > 在外围类的成员方法中，要想访问内部类成员，需要创建成员内部类对象。
     >
     > - 直接new创建，用对象名点访问

### 1.成员内部类内部访问外围类

- 直接访问
- 如果存在同名的成员，this指向成员内部类对象，外围类类名点this指向外围类对象

### 2.外围类访问成员内部类成员

- 直接new创建
- 静态方法：先创建外围类对象，再创建成员内部类对象

### 3.外部类访问成员内部类成员

- 先创建外围类对象，然后在外围类对象的基础上创建成员内部类对象，这些都是受访问权限限制的。

### 4.成员内部类访问外部类成员

- 创建外部类对象即可

# 二、静态内部类

## 1.成员内部类和静态内部类的区别：

- 成员内部类必须依赖外围类存在，创建成员内部类对象必须持有外围类对象的引用。
- 静态内部类和外围类就是独立的两个类，只不过静态内部类借用了外围类来保护自己。

## 2.要点

1. 创建对象
   - 静态内部类创建对象不需要依赖于外围类对象
2. 类加载
   - 静态内部类和外围类的类加载不会互相影响，没有关系

## 3.两大原则

1. 静态内部类和外围类相互访问不受权限限制
2. 静态内部类对象，不会依赖于外围类对象的存在而存在
   - 静态内部类的成员方法/静态方法中，访问外围类成员，直接创建外围类对象即可，访问不受权限限制
     - 外围类的成员方法/静态方法中，访问静态内部类成员，直接创建静态内部类对象即可。不受访问权限限制

# 三、局部内部类

## 1.概述

- 定义在一个方法或者一个作用域里面的类，简单来说，将局部类看成是局部变量即可。该类的有效范围仅在作用域内部。

## 2.特点

- 访问权限修饰符：已被作用域限制死了作用范围，不需要访问权限修饰
- 成员特点：和成员内部类完全一致，没有静态声明，但是可以存在字面值常量赋值的全局常量。
- 继承和实现：可以继承，可以实现。

## 3.两个原则

1. 局部内部类仅在作用域内部生效，必须在作用域内部创建它的对象，才能生效。
2. 局部内部类无条件访问外围类成员，但是外围类必须在装有局部内部类的那个作用域内部才能访问局部内部类成员。

## 4.局部内部类与外围类之间的访问

1. 局部内部类内部访问外围类

   > 1. 如果是处在外围类的成员方法中的局部内部类，
   >    - 会将外围类对象的引用作为自身对象的成员变量持有，可直接访问外围类成员
   >    - this指向当前自身局部内部类对象；外围类类名.this指向外围类对象
   > 2. 如果是处在外围类的静态成员方法中的局部内部类：
   >    - 此时局部内部类不会持有外围类对象的引用，所以需要创建对象

2. 外围类访问局部内部类成员

   > 首先，必须在装有局部内部类的作用域内部访问，new对象访问；但是出了作用域，就无法访问

3. 外部类访问局部内部类成员

   > 不能访问，访问不到

4. 局部内部类访问外部类成员

   > 可以访问，创建对象，受访问权限限制

## 5.优缺点

1. 优点
   - 绝对封装，绝对隐藏，对外界不可见
2. 缺点
   - 一次性的类，在方法中使用完毕，在其他地方不可用

## 6.注意事项

- 局部内部类的成员方法中，可以访问作用域内部定义在上面的一个局部变量，但是一旦在**局部内部类中访问了该局部变量，那么该局部变量就会成为一个常量，隐式的被final修饰。**

  > why？
  >
  > 1. 首先考虑的是对象和方法内局部变量的生命周期冲突
  >    - 方法出栈后，局部变量随之销毁，但是对象却不会，如果对象中的方法需要访问局部变量，但这时局部变量已经不存在了，这就是生命周期冲突
  >    - 为了解决这个生命周期冲突，创建局部内部类对象时，JVM会自动将对象的成员方法的需要访问的局部变量，作为对象的成员变量。
  > 2. 以上解决了生命周期的问题，但解决问题的方案可能本身就是一个问题，又会引入新的问题。
  >    - 如果允许在局部内部类当中修改该局部变量的取值，那么：就存在了“同步取值”的问题。
  >    - 同步问题的解决方案也许还会引入新的问题，最终JAVA的设计者，决定不允许修改取值，将局部变量作为一个常量。
  >    - 补充：在Java7和之前的版本中，这个局部变量必须显式的声明为final，否则会编译报错，Java8之后会自动加上。

# 四、内部类的使用场景

1. 无条件的访问外围类的所有元素
2. 隐藏类
3. 实现多继承